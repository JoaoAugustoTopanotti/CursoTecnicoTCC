(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[60],{7058:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/agendamento",function(){return a(4860)}])},4860:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var n=a(5893),o=a(7294),s=a(2600),i=a(109),r=a(1163),l=a(5381);let d={_origin:"https://api.emailjs.com"},c=(e,t,a)=>{if(!e)throw"The user ID is required. Visit https://dashboard.emailjs.com/admin/integration";if(!t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!a)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates";return!0};class u{constructor(e){this.status=e.status,this.text=e.responseText}}let h=(e,t,a={})=>new Promise((n,o)=>{let s=new XMLHttpRequest;s.addEventListener("load",({target:e})=>{let t=new u(e);200===t.status||"OK"===t.text?n(t):o(t)}),s.addEventListener("error",({target:e})=>{o(new u(e))}),s.open("POST",d._origin+e,!0),Object.keys(a).forEach(e=>{s.setRequestHeader(e,a[e])}),s.send(t)});var m={send:(e,t,a,n)=>{let o=n||d._userID;return c(o,e,t),h("/api/v1.0/email/send",JSON.stringify({lib_version:"3.2.0",user_id:o,service_id:e,template_id:t,template_params:a}),{"Content-type":"application/json"})}},p=function(){let[e,t]=(0,o.useState)([]),[a,d]=(0,o.useState)([]),[c,u]=(0,o.useState)({}),[h,p]=(0,o.useState)(""),[f,_]=(0,o.useState)(0),[g,x]=(0,o.useState)(""),{currentUser:j}=(0,l.a)(),b=(0,r.useRouter)();(0,o.useEffect)(()=>{j||b.push("/login")},[j,b]),(0,o.useEffect)(()=>{(async()=>{if(j){let e=(0,i.IO)((0,i.hJ)(s.db,"Pets"),(0,i.ar)("UsuarioID","==",j.uid));t((await (0,i.PL)(e)).docs.map(e=>({id:e.id,...e.data()})))}})()},[j]);let v=e=>{d(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},w=(e,t)=>{u(a=>({...a,[e]:t}))};(0,o.useEffect)(()=>{(async()=>{let e=0;for(let t of a){let a=(await (0,i.QT)((0,i.JU)(s.db,"Pets",t))).data().ValorBanho;"banho_e_tosa_completo"===c[t]?e+=a+20:e+=a}_(e)})()},[a,c]);let y=async e=>{e.preventDefault();let t=new Date(h),n=new Date;if(0===a.length||!h){x("Por favor, preencha todos os campos.");return}if(t<=n){x("A data do agendamento deve ser posterior a hoje.");return}try{let e=[];for(let n of a){let a=(await (0,i.QT)((0,i.JU)(s.db,"Pets",n))).data(),o=c[n],r=a.ValorBanho;e.push(a?.Nome||"Nome n\xe3o dispon\xedvel"),await (0,i.ET)((0,i.hJ)(s.db,"Agendamentos"),{DataHora:t,PetID:n,TipoPelagem:a?.Pelagem||"",UsuarioID:j.uid,Valor:"banho_e_tosa_completo"===o?r+20:r,Status:"Pendente"})}let n={to_email:j.email,user_name:j.displayName||j.email,appointment_date:t.toLocaleString(),pet_name:e.join(", "),price:f.toFixed(2)};await m.send("service_7xoagkl","template_h32yvo8",n,"MBiM7SIBygzCqO4sU"),alert("Agendamento realizado com sucesso!"),b.push("/")}catch(e){x("Erro ao realizar o agendamento. Tente novamente."),console.error("Erro ao realizar o agendamento: ",e)}};return j?(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Agendar Banho e Tosa"}),g&&(0,n.jsx)("p",{style:{color:"red"},children:g}),(0,n.jsxs)("form",{onSubmit:y,children:[e.map(e=>(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsxs)("label",{style:{marginRight:"10px"},children:[(0,n.jsx)("input",{type:"checkbox",checked:a.includes(e.id),onChange:()=>v(e.id)}),e.Nome]}),a.includes(e.id)&&(0,n.jsxs)("label",{style:{marginLeft:"10px"},children:["Selecione o Servi\xe7o:",(0,n.jsxs)("select",{onChange:t=>w(e.id,t.target.value),children:[(0,n.jsx)("option",{value:"apenas_banho",children:"Apenas Banho"}),(0,n.jsx)("option",{value:"banho_e_tosa_completo",children:"Banho e Tosa Completo (+ R$ 20,00)"})]})]}),(0,n.jsx)("br",{})]},e.id)),(0,n.jsxs)("label",{children:["Data e Hora:",(0,n.jsx)("input",{type:"datetime-local",value:h,min:(()=>{let e=new Date,t=6e4*e.getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,16)})(),onChange:e=>p(e.target.value)})]}),(0,n.jsx)("br",{}),(0,n.jsxs)("p",{children:["Valor total: R$ ",f.toFixed(2)]}),(0,n.jsx)("button",{type:"submit",children:"Confirmar Agendamento"})]})]}):(0,n.jsx)("div",{children:"Voc\xea precisa estar logado para agendar um banho e tosa."})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=7058)}),_N_E=e.O()}]);